#Static Malware Family Classifier based on Graph Comparison 
# Â© Created By - Devyani Vij
#Header Files
import optparse
import networkx as nx
import re
import matplotlib.pyplot as plt
import pylab
import warnings
import os
import glob
import pyfiglet

warnings.filterwarnings("ignore")
a=False

#Banner 
ascii_banner = pyfiglet.figlet_format("Android \t Application \t Family \t Classifier",width=100)

print(ascii_banner)

#Defining options
parser = optparse.OptionParser()

parser.add_option("-p","--path",dest="path",help="Input the Path of the Graph.")
parser.add_option("-g","--graph",dest="graph",help="Input the Name of the Graph.")
parser.add_option("-d","--dataset",dest="data",help="Input the Dataset.")
(options,arguments)=parser.parse_args()

if not options.path:
    parser.error("[-] Please specify the Path of the GML using -p or --path")
elif not options.graph:
    parser.error("[-] Please specify the GRAPH name by using -g or --graph")
elif not options.data:
    parser.error("[-] Please specify the DATASET path name by using -d or --data")

#Reading the users entered .gml file
os.getcwd()
os.chdir(options.path)
os.getcwd()

arr = [x for x in os.listdir() if x.endswith(options.graph)] 

files=glob.glob('*.gml') 
G1 = nx.read_gml(arr[0],label='label')

#Reading the .gml dataset provide.
os.getcwd()
os.chdir(options.data)
os.getcwd()
files=glob.glob('*.gml') 

#Checking whether the .gml belongs to any .gml in the dataset or not
for file in files:
    J1 = nx.read_gml(file,label='label')
    if(nx.is_isomorphic(J1,G1)):
        a=True
        b=file
        break
    else:
        continue

print("\033[93mThe Application belongs to - ")

#Print whether it belongs to a family or it's Unknown/Goodware        
if(a):
    b = b.split('.gml')
    print('\033[96m'+b[0]+' Android Family')
else:
    print("\033[96mUnknown / GOODWARE")
    
    
